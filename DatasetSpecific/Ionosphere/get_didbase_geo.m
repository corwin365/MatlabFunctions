function [Stations] = get_didbase_geo(LonRange,LatRange,TimeRange)
%% identifies DIDbase stations in a given lat,lon box
%% to do: filter by time range as well

% % %   %testing parameters
% % %   LatRange = [-1,1].*5+42.60;
% % %   LonRange = [-1,1].*5+288.50-360;
% % %   TimeRange = [datenum(2016,6,1),datenum(2016,12,3)];


  %% load the location database
  Locations = { ...
'AH223','AHMEDABAD',23,72.5,'Jun 05 2012','Jan 31 2013';...
'AL945','ALPENA',45.07,276.44,'Apr 11 2014','Feb 20 2017';...
'AN438','ANYANG',37.39,126.95,'May 01 1998','Aug 05 2009';...
'AS00Q','ASCENSION ISLAND',-7.95,345.6,'Mar 22 1997','Feb 20 2017';...
'AT138','ATHENS',38,23.5,'Jan 15 2002','Feb 20 2017';...
'AU930','AUSTIN',30.4,262.3,'Sep 07 2003','Feb 20 2017';...
'BP440','BEIJING',40.3,116.2,'Oct 07 2010','Feb 18 2017';...
'BJJ32','BERMUDA',32.4,295.3,'Jan 01 2000','Feb 21 2001';...
'BVJ03','BOA VISTA',2.8,299.3,'Oct 05 2002','Feb 20 2017';...
'BC840','BOULDER',40,254.7,'Mar 23 2004','Feb 20 2017';...
'BR52P','BRISBANE',-27.06,153.06,'May 09 2016','Feb 20 2017';...
'BV53Q','BUNDOORA',-37.7,145.05,'Jan 15 2002','Aug 28 2008';...
'CXM9B','CACHIMBO',-9.5,305.2,'Sep 28 2002','Dec 10 2002';...
'CAJ2M','CACHOEIRA PAULISTA',-22.7,315,'Jul 14 2000','Feb 20 2017';...
'CN53L','CAMDEN',-34.05,150.67,'May 09 2016','Feb 20 2017';...
'CGK21','CAMPO GRANDE',-20.5,305,'Sep 17 2002','Feb 20 2017';...
'CB53N','CANBERRA',-35.32,149,'May 09 2016','Feb 20 2017';...
'CH833','CHERRY',32.9,253.59,'Jan 15 2014','Jan 29 2014';...
'RL052','CHILTON',51.5,359.4,'Dec 16 1996','Feb 20 2017';...
'CS31K','COCOS_ISLAND',-12.18,96.83,'May 09 2016','Feb 20 2017';...
'CO764','COLLEGE AK',64.9,212,'Dec 31 1999','May 19 2010';...
'CS839','COLORADO_SPRINGS',39,255.12,'Dec 22 2008','Dec 29 2008';...
'DW41K','DARWIN',-12.45,130.95,'May 09 2016','Feb 20 2017';...
'DB049','DOURBES',50.1,4.6,'Jan 01 2001','Feb 20 2017';...
'DS932','DYESS AFB',32.4,260.2,'Dec 31 1999','Apr 23 2009';...
'EG931','EGLIN AFB',30.5,273.5,'Dec 31 1999','Feb 20 2017';...
'EI764','EIELSON',64.66,212.93,'Jan 01 2006','Feb 20 2017';...
'EA036','EL ARENOSILLO',37.1,353.3,'Apr 17 2000','Feb 20 2017';...
'FF051','FAIRFORD',51.7,358.5,'Mar 25 2000','Feb 20 2017';...
'FZA0M','FORTALEZA',-3.9,321.6,'Mar 22 2001','Feb 20 2017';...
'GA313','GADANKI',13.46,79.17,'Apr 16 2015','Aug 25 2015';...
'GA762','GAKONA',62.38,215,'Oct 03 1998','Feb 20 2017';...
'GM037','GIBILMANNA',37.9,14,'Apr 27 2009','Feb 20 2017';...
'GSJ53','GOOSE BAY',53.3,299.7,'Apr 18 1995','May 10 2010';...
'GR13L','GRAHAMSTOWN',-33.3,26.5,'Apr 12 1996','Feb 20 2017';...
'GU513','GUAM',13.62,144.86,'Aug 16 2012','Feb 20 2017';...
'HA419','HAINAN',19.4,109,'Mar 24 2002','Jan 13 2014';...
'HAJ43','HANSCOM AFB',42.5,288.7,'Mar 22 1997','Aug 19 2003';...
'HE13N','HERMANUS',-34.42,19.22,'Jul 04 2008','Feb 20 2017';...
'HO54K','HOBART',-42.92,147.32,'May 09 2016','Feb 20 2017';...
'IC437','I-CHEON',37.14,127.54,'Jun 06 2010','Feb 20 2017';...
'AC843','IDAHO NATIONAL LAB',43.81,247.32,'Jan 25 2012','Sep 11 2012';...
'IF843','IDAHO NATIONAL LAB',43.81,247.32,'Feb 19 2013','Feb 20 2017';...
'IL008','ILORIN',8.5,4.5,'Mar 26 2010','Apr 17 2014';...
'IR352','IRKUTSK',52.4,104.3,'Nov 30 2002','Aug 28 2013';...
'JJ433','JEJU',33.43,126.3,'Jan 05 2009','Feb 20 2017';...
'JI91J','JICAMARCA',-12,283.2,'Jul 20 1993','Feb 20 2017';...
'JR055','JULIUSRUH',54.6,13.4,'Jan 01 2001','Feb 20 2017';...
'KS759','KING SALMON',58.4,203.6,'Dec 31 1999','Feb 11 2016';...
'KR835','KIRTLAND',35,253.47,'Jan 02 2014','Jan 28 2014';...
'TO535','KOKUBUNJI',35.7,139.5,'Oct 30 2001','Oct 30 2001';...
'KJ609','KWAJALEIN',9,167.2,'Nov 17 1999','Nov 07 2013';...
'LA42Q','LAVERTON',-28.3,122.8,'Mar 04 2008','Mar 04 2008';...
'LM42B','LEARMONTH',-21.8,114.1,'Dec 31 1999','Oct 07 2016';...
'LV12P','LOUISVALE',-28.5,21.2,'Aug 17 2000','Feb 01 2017';...
'KP721','LUALUALEI',21.57,201.74,'Nov 25 2015','Dec 04 2015';...
'MU12K','MADIMBO',-22.39,30.88,'Jan 01 2000','Feb 20 2017';...
'ME929','MELROSE',29.71,278,'Jul 16 2014','Feb 20 2017';...
'MHJ45','MILLSTONE HILL',42.6,288.5,'Mar 20 1992','Feb 20 2017';...
'MH453','MOHE',52,122.52,'Aug 27 2013','Feb 12 2017';...
'MO155','MOSCOW',55.47,37.3,'Oct 26 2008','Feb 20 2017';...
'MU230','MULTAN',33.03,72.01,'Mar 01 2009','Mar 31 2009';...
'MU834','MUNYO',33.56,253.35,'Jan 14 2014','Jan 28 2014';...
'NQJ61','NARSSARSSUAQ',61.2,314.6,'Mar 25 2000','Nov 25 2008';...
'NI135','NICOSIA',35.03,33.16,'Sep 17 2008','Feb 20 2017';...
'ND61R','NIUE',-19.07,-169.93,'May 07 2016','Feb 20 2017';...
'NDA81','NORD GREENLAND',81.4,342.5,'Aug 08 2006','Jun 30 2013';...
'NI63_','NORFOLK',-29.03,167.97,'May 09 2016','Feb 20 2017';...
'NO369','NORILSK',69.2,88,'Dec 06 2002','Jun 06 2013';...
'OK426','OKINAWA',26.68,128.15,'Dec 31 2001','Apr 05 2003';...
'OL246','OLSZTYN',53.8,20.5,'May 02 2014','Dec 31 2015';...
'SN437','OSAN AB',37.1,127,'Dec 31 1999','Aug 17 2006';...
'PE43K','PERTH',-32,116.13,'Apr 30 2016','Feb 20 2017';...
'PSJ5J','PORT STANLEY',-51.6,302.1,'Feb 27 1996','Feb 20 2017';...
'PQ052','PRUHONICE',50,14.6,'Jan 20 2004','Feb 20 2017';...
'PA836','PT ARGUELLO',34.8,239.5,'May 07 1998','Feb 20 2017';...
'THJ77','QAANAAQ',77.5,290.8,'Jan 01 1987','Aug 20 2014';...
'PRJ18','RAMEY',18.5,292.9,'Jun 09 1999','Feb 20 2017';...
'RM041','ROME',41.8,12.5,'Nov 25 2004','Feb 20 2017';...
'RO041','ROME',41.9,12.5,'Jun 07 1997','Feb 20 2017';...
'EB040','ROQUETES',40.8,0.5,'Jun 06 1988','Feb 20 2017';...
'VT139','SAN VITO',40.6,17.8,'Aug 02 2000','Feb 20 2017';...
'SA418','SANYA',18.34,109.42,'Aug 17 2013','Feb 20 2017';...
'SAA0K','SAOLUIS',-2.6,315.8,'Jan 19 1997','Feb 20 2017';...
'SMJ67','SONDRESTROM',66.98,309.06,'Oct 27 1989','Sep 07 2012';...
'SH42','SOUTH HEDLAND',-20.4,118.5,'Mar 04 2008','Mar 04 2008';...
'SQ832','SQUIRT',32.42,253.71,'Jan 08 2014','Jan 28 2014';...
'TV51R','TOWNSVILLE',-19.63,146.85,'Apr 30 2016','Feb 20 2017';...
'TM308','TRIVANDRUM',8.54,76.87,'Feb 03 2009','Jun 30 2010';...
'TR169','TROMSO',69.6,19.2,'Jul 01 1993','Feb 20 2017';...
'TUJ2O','TUCUMAN',-26.9,294.6,'Nov 11 2002','Dec 22 2006';...
'TNJ20','TUCUMAN AIS-INGV',-26.9,294.6,'Mar 01 2014','Feb 20 2017';...
'WP937','WALLOPS IS',37.9,284.5,'Dec 31 1999','Feb 20 2017';...
'MZ152','WARSAW',52.2,21.1,'Apr 19 2012','Feb 20 2017';...
'WU430','WUHAN',30.5,114.4,'Jan 27 2002','Feb 20 2017';...
'XI434','XINXIANG CHINA',35.3,113.92,'Jun 20 2006','Jun 24 2006';...
'YA462','YAKUTSK',62,129.6,'Nov 29 2002','Feb 20 2017';...
'ZH466','ZHIGANSK',66.8,123.4,'Nov 12 2003','Sep 17 2016';...
'ZS36R','ZHONG SHAN',-69.4,76.4,'Jan 01 2005','Dec 26 2005'
    };

  %% extract lat and lon, to make searchable
  %also put lons in the range -180 to 180
  Lat = cell2mat(Locations(:,3));
  Lon = cell2mat(Locations(:,4)); Lon(Lon > 180) = Lon(Lon > 180)-360;
  
  %reformat dates
  for iCol=5:1:6;
    for iRow=1:1:size(Locations,1);
      Locations{iRow,iCol} = datenum(Locations(iRow,iCol),'mmm dd yyyy');
      
      %list was made on 20/FEB/2017
      %so set any 2017 end date to the far future
      if Locations{iRow,iCol} >= datenum(2017,1,1); 
        Locations{iRow,iCol} = datenum(9999,12,31);
      end
    end
  end
  StartTimes = cell2mat(Locations(:,5));
  EndTimes   = cell2mat(Locations(:,6));
  

  %hence, find all stations in box of interest
  %and which have data in the period of interest
  InBox = find(Lat >= min(LatRange) ...
             & Lat <= max(LatRange) ...
             & Lon >= min(LonRange) ...
             & Lon <= max(LonRange));
  TimeCovered = find(StartTimes <= max(TimeRange) ...
                   & EndTimes   >= min(TimeRange));
  Useful = intersect(InBox,TimeCovered);
                 
  %sort in order from S to N (arbitrary)
  [~,Order] = sort(Lat(Useful)); Useful = Useful(Order);
  
  %and return
  Stations = Locations(Useful,:);
  %shift lons into correct range
  for i=1:1:numel(Useful); Stations{i,4} = Lon(Useful(i));end
  
%   return